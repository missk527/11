<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Miss K English class</title>
<style>
:root{
  --kids-bg:#FFF7CC; --kids-panel:#FFE680; --kids-panel-2:#FFEF99;
  --kids-accent:#FFB703; --kids-accent-2:#FB8500; --kids-text:#3A2D00;
  --kids-muted:#6B5600; --kids-border:#FFD259; --kids-shadow:0 6px 18px rgba(160,120,0,.18);
  --kids-radius:12px;
}
body{background:var(--kids-bg);color:var(--kids-text);
  font-family:"Comic Sans MS","Noto Sans TC","Microsoft JhengHei",system-ui,Arial,sans-serif;
  line-height:1.6;padding-bottom:90px;}
header{background:linear-gradient(180deg,var(--kids-panel),var(--kids-panel-2));
  border-bottom:2px dashed var(--kids-border);box-shadow:var(--kids-shadow);
  padding:14px 18px;display:flex;justify-content:space-between;align-items:center;}
h1{color:var(--kids-text);font-size:18px;margin:0;}h1::before{content:"ğŸ¦";margin-right:6px;}
.btn{padding:10px 14px;border:2px solid var(--kids-border);border-radius:20px;
  background:#fff8d9;color:var(--kids-text);box-shadow:var(--kids-shadow);font-weight:700;}
.btn.primary{background:var(--kids-accent);border-color:var(--kids-accent-2);color:#1b1100;}
textarea{width:100%;height:220px;border-radius:14px;border:2px solid var(--kids-border);
  background:#fffef5;color:var(--kids-text);font-size:15px;padding:10px;}
#status{border:2px dashed var(--kids-border);border-radius:var(--kids-radius);
  background:#fff7d1;color:var(--kids-text);box-shadow:var(--kids-shadow);padding:12px;margin:18px;}
.grid{display:grid;gap:14px;margin:18px;}
@media (min-width:800px){.grid{grid-template-columns:1fr 1fr;}}
.panel{background:#fffbea;border:2px solid var(--kids-border);border-radius:var(--kids-radius);
  padding:14px;box-shadow:var(--kids-shadow);}
label{display:block;margin-bottom:8px;font-weight:900;color:var(--kids-muted);}
.hl-del{background:#ffe3e3;text-decoration:line-through;border-radius:4px;padding:0 2px;}
.hl-ins{background:#ddf8dd;border-bottom:2px solid #2d8a2d;border-radius:4px;padding:0 2px;}
.small{font-size:13px;color:#5f4b00;}
#review{display:none;margin:18px;}
body::after{content:" ğŸ»ğŸ°ğŸ¦Š ä¸€èµ·å­¸English ï¼ ";position:fixed;right:10px;bottom:6px;
  background:#fff;border:2px solid var(--kids-border);border-radius:14px;
  padding:8px 10px;box-shadow:var(--kids-shadow);font-weight:800;color:var(--kids-text);
  transform:scale(.9);pointer-events:none;}
@media (max-width:480px){body{padding-bottom:110px;}body::after{bottom:2px;right:6px;transform:scale(.85);}}
</style>
</head>
<body>
<header>
  <h1>Miss K English class</h1>
  
</header>

<div class="grid">
  <div class="panel">
    <label>ä¸­æ–‡</label>
    <textarea id="inputZh" placeholder="è¼¸å…¥ä¸­æ–‡"></textarea>
    <div class="row">
      <button id="btnZhEn" class="btn primary">ä¸­æ–‡ âœ è‹±æ–‡</button>
      <button id="btnClearZh" class="btn">æ¸…ç©º</button>
    </div>
  </div>

  <div class="panel">
    <label>English</label>
    <textarea id="outputEn" placeholder="ç¿»è­¯çµæœ"></textarea>
    <div class="row">
      <button id="btnEnZh" class="btn primary">è‹±æ–‡ âœ ä¸­æ–‡</button>
      <button id="btnCheck" class="btn">Grammar</button>
      <button id="btnClearEn" class="btn">æ¸…ç©º</button>
    </div>
  </div>
</div>

<div id="status">âœ¨ ç›´æ¥è¼¸å…¥ä¸­æ–‡æˆ–è‹±æ–‡å³å¯ã€‚</div>

<div id="review" class="panel">
  <strong>ğŸ›  ä¿®æ­£ç´°ç¯€</strong>
  <p class="small">ç´…è‰²åˆªé™¤ï¼Œç¶ è‰²æ–°å¢ã€‚</p>
  <div><strong>åŸå¥ï¼š</strong> <span id="origHL"></span></div>
  <div><strong>ä¿®æ­£æ–‡ï¼š</strong> <span id="corrHL"></span></div>
</div>

<script>
(function(){
  const ui={inputZh:document.getElementById('inputZh'),outputEn:document.getElementById('outputEn'),
    zh2en:document.getElementById('btnZhEn'),en2zh:document.getElementById('btnEnZh'),
    check:document.getElementById('btnCheck'),clearZh:document.getElementById('btnClearZh'),
    clearEn:document.getElementById('btnClearEn'),status:document.getElementById('status'),
    save:document.getElementById('btnSave'),diag:document.getElementById('btnDiag'),
    origHL:document.getElementById('origHL'),corrHL:document.getElementById('corrHL'),
    review:document.getElementById('review')};
  function setStatus(msg){ui.status.textContent=msg;}
  function escapeHTML(s){return s.replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}
  function matchCase(target,sample){if(sample===sample.toUpperCase())return target.toUpperCase();
    if(sample[0]===sample[0].toUpperCase())return target[0].toUpperCase()+target.slice(1);return target;}

  // === ä¸è¦å‰‡å‹•è©è¡¨ (ç•¥ï¼Œèˆ‡ä¸Šä¸€ç‰ˆç›¸åŒ) ===
  const IRR={ "am":["was","been"], "is":["was","been"], "are":["were","been"],
    "do":["did","done"],"does":["did","done"],"go":["went","gone"],"come":["came","come"],
    "eat":["ate","eaten"],"see":["saw","seen"],"take":["took","taken"],"make":["made","made"],
    "have":["had","had"],"has":["had","had"],"get":["got","gotten"],"give":["gave","given"],
    "write":["wrote","written"],"read":["read","read"],"run":["ran","run"],"sleep":["slept","slept"],
    "feel":["felt","felt"],"leave":["left","left"],"meet":["met","met"],"pay":["paid","paid"],
    "put":["put","put"],"say":["said","said"],"buy":["bought","bought"],"bring":["brought","brought"],
    "think":["thought","thought"],"teach":["taught","taught"],"begin":["began","begun"],
    "become":["became","become"],"find":["found","found"],"hold":["held","held"],"keep":["kept","kept"],
    "speak":["spoke","spoken"],"drink":["drank","drunk"],"drive":["drove","driven"],
    "forget":["forgot","forgotten"],"forgive":["forgave","forgiven"],"grow":["grew","grown"],
    "know":["knew","known"],"lose":["lost","lost"],"send":["sent","sent"],"sit":["sat","sat"],
    "stand":["stood","stood"],"understand":["understood","understood"],"win":["won","won"]};
  function toPast(v){if(IRR[v])return IRR[v][0];if(/[^aeiou]y$/.test(v))return v.slice(0,-1)+"ied";
    if(v.endsWith("e"))return v+"d";return v+"ed";}
  function toPart(v){if(IRR[v])return IRR[v][1]||IRR[v][0];if(/[^aeiou]y$/.test(v))return v.slice(0,-1)+"ied";
    if(v.endsWith("e"))return v+"d";return v+"ed";}

  // === æ‹¼å­—è¡¨ (ç•¥ï¼Œèˆ‡ä¸Šä¸€ç‰ˆç›¸åŒ) ===
  const SPELL={"becuase":"because","recieve":"receive","seperate":"separate","definately":"definitely",
    "wierd":"weird","adress":"address","enviroment":"environment","tomatos":"tomatoes","alot":"a lot",
    "occured":"occurred","wich":"which","thier":"their","beleive":"believe","freind":"friend",
    "studing":"studying","untill":"until"};

  // === æœ¬åœ°è¦å‰‡ ===
  function localFixOnce(src){
    let s=src,c=0;
    // æ‹¼å­—
    s=s.replace(/\b([A-Za-z']+)\b/g,(m,w)=>{const low=w.toLowerCase();if(SPELL[low]){c++;return matchCase(SPELL[low],w);}return w;});
    // him/her/them
    s=s.replace(/\b(him|her|them)\s+([A-Za-z]+)\b/g,(m,p1,p2)=>{c++;return(p1==='him'?'his':p1==='her'?'her':'their')+' '+p2;});
    // a/an
    s=s.replace(/\b(a)\s+([aeiouAEIOU])/g,(m,a,v)=>{c++;return'an '+v;});
    s=s.replace(/\b(an)\s+([^aeiouAEIOU\s])/g,(m,an,cons)=>{c++;return'a '+cons;});
    // ä¸»è¬‚ä¸€è‡´ï¼ˆhe/she/itï¼‰
    s=s.replace(/\b(he|she|it)\s+(go|do|have|say|play|watch|clean|study|try|fly|cry|walk|work|eat|come)\b/gi,
      (m,subj,verb)=>{const v=verb.toLowerCase();if(v==='have')return`${subj} has`;
        if(v==='do')return`${subj} does`;if(v==='go')return`${subj} goes`;
        if(/(y)$/.test(v)&&!/[aeiou]y$/.test(v))return`${subj} ${v.slice(0,-1)}ies`;
        if(v.endsWith('sh')||v.endsWith('ch')||v.endsWith('x')||v.endsWith('s')||v.endsWith('o'))return`${subj} ${v}es`;
        return`${subj} ${v}s`;});
    // --- NEW: friends ä¿®æ­£ ---
    s=s.replace(/\bfriends\s+is\b/gi,()=>{c++;return"friends are";});
    s=s.replace(/\bare\s+vegetarian\b/gi,()=>{c++;return"are vegetarians";});
    (()=>{const femaleNames=/^(susan|mary|anna|amy|lisa|jane|kate|linda|sarah|emily|emma|lucy|lily|grace|olivia|sophia|mia|chloe)$/i;
      s=s.replace(/\b([A-Z][a-z]+)\s+and\s+his\s+friends\b/g,(m,name)=>{if(femaleNames.test(name)){c++;return`${name} and her friends`;}c++;return`${name} and their friends`;});})();
    // å…¶ä»–è¦å‰‡ï¼ˆä»‹ç³»è©ã€æ™‚æ…‹â€¦ ç•¥ï¼Œä¿ç•™ä¸Šä¸€ç‰ˆå…§å®¹å³å¯ï¼‰
    return {text:s,count:c};
  }

  async function grammarPipeline(text){return{text:text,total:0,passes:1};} // ç°¡åŒ–ç¤ºæ„

  function diffHL(oldText,newText){if(oldText===newText)return{origHL:escapeHTML(oldText),corrHL:escapeHTML(newText)};return{origHL:escapeHTML(oldText),corrHL:escapeHTML(newText)};}

  // UI
  ui.check.addEventListener('click',async()=>{const txt=ui.outputEn.value.trim();if(!txt)return;
    const res=localFixOnce(txt);ui.outputEn.value=res.text;
    const d=diffHL(txt,res.text);if(res.text!==txt){ui.origHL.innerHTML=d.origHL;ui.corrHL.innerHTML=d.corrHL;ui.review.style.display="block";}
    else{ui.review.style.display="none";}setStatus("âœ… å®Œæˆ Grammar");});
})();
</script>
</body>
</html>
