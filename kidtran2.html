<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Miss K english class</title>
<style>
  body { margin:0; font-family:system-ui,Arial; background:#0f172a; color:#e5e7eb; }
  header { background:#1e293b; padding:10px 16px; display:flex; justify-content:space-between; align-items:center; }
  h1 { font-size:16px; margin:0; }
  .btn { padding:6px 12px; border:1px solid #334155; border-radius:6px; background:#1e293b; color:#e5e7eb; cursor:pointer; }
  .btn.primary { background:#3b82f6; border-color:#2563eb; color:#fff; }
  .grid { display:grid; gap:12px; margin:16px; }
  @media(min-width:800px){ .grid { grid-template-columns:1fr 1fr; } }
  textarea { width:100%; height:220px; border-radius:6px; border:1px solid #334155; background:#0f172a; color:#e5e7eb; padding:8px; resize:vertical; }
  .row { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
  #status { white-space:pre-wrap; margin:16px; font-size:14px; padding:8px; border:1px dashed #475569; border-radius:6px; background:#1e293b; }
</style>
<style>
/* Kids Yellow Theme — drop-in override for tran.html */
/* Usage: <link rel="stylesheet" href="kids-yellow.css"> (place after existing <style>) */

:root{
  --kids-bg:#FFF7CC;
  --kids-panel:#FFE680;
  --kids-panel-2:#FFEF99;
  --kids-accent:#FFB703;
  --kids-accent-2:#FB8500;
  --kids-text:#3A2D00;
  --kids-muted:#6B5600;
  --kids-border:#FFD259;
  --kids-shadow:0 6px 18px rgba(160,120,0,.18);
  --kids-radius:12px;
}

/* ==== 基本底色與字體（不動結構） ==== */
body{
  background: var(--kids-bg) !important;
  color: var(--kids-text) !important;
  font-family: "Comic Sans MS","Noto Sans TC","PingFang TC","Microsoft JhengHei",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif !important;
  line-height:1.6;
  /* 柔和的動物圖案背景（純資料URI、URL安全編碼） */
  background-image:
    radial-gradient(circle at 12% 10%, rgba(255,255,255,.6) 0 40%, transparent 41%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cdefs%3E%3Cstyle%3E.a%7Bfill:%23FFE680;stroke:%23FFB703;stroke-width:3%7D.b%7Bfill:%23FFFFFF;opacity:.8%7D.c%7Bfill:%233A2D00%7D%3C/style%3E%3C/defs%3E%3Cg transform='translate(20,18)'%3E%3Ccircle cx='30' cy='30' r='22' class='a'/%3E%3Ccircle cx='30' cy='30' r='16' class='b'/%3E%3Ccircle cx='24' cy='26' r='3' class='c'/%3E%3Ccircle cx='36' cy='26' r='3' class='c'/%3E%3Cpath d='M22 36 q8 6 16 0' fill='none' stroke='%233A2D00' stroke-width='3' stroke-linecap='round'/%3E%3C/g%3E%3Cg transform='translate(120,28)'%3E%3Ccircle cx='30' cy='32' r='18' class='a'/%3E%3Ccircle cx='18' cy='20' r='7' class='a'/%3E%3Ccircle cx='42' cy='20' r='7' class='a'/%3E%3Ccircle cx='30' cy='32' r='12' class='b'/%3E%3Ccircle cx='25' cy='30' r='3' class='c'/%3E%3Ccircle cx='35' cy='30' r='3' class='c'/%3E%3Crect x='27' y='36' width='6' height='4' rx='2' class='c'/%3E%3C/g%3E%3Cg transform='translate(60,120)'%3E%3Cellipse cx='30' cy='30' rx='18' ry='16' class='a'/%3E%3Crect x='22' y='0' width='8' height='22' rx='4' class='a'/%3E%3Crect x='30' y='0' width='8' height='22' rx='4' class='a'/%3E%3Cellipse cx='30' cy='30' rx='12' ry='10' class='b'/%3E%3Ccircle cx='26' cy='28' r='3' class='c'/%3E%3Ccircle cx='34' cy='28' r='3' class='c'/%3E%3Cpath d='M24 36 q6 6 12 0' fill='none' stroke='%233A2D00' stroke-width='3' stroke-linecap='round'/%3E%3C/g%3E%3C/svg%3E");
  background-size: auto, 280px 280px;
  background-repeat: repeat;
  background-attachment: fixed;
}

/* ==== 頂部列 ==== */
header{
  background: linear-gradient(180deg, var(--kids-panel), var(--kids-panel-2)) !important;
  border-bottom: 2px dashed var(--kids-border) !important;
  box-shadow: var(--kids-shadow) !important;
}
h1{ color: var(--kids-text) !important; }
h1::before{ content:"🦁"; margin-right:6px; }

/* ==== 按鈕 ==== */
.btn{
  padding:10px 14px !important;
  border:2px solid var(--kids-border) !important;
  border-radius:20px !important;
  background:#fff8d9 !important;
  color:var(--kids-text) !important;
  box-shadow: var(--kids-shadow) !important;
  font-weight:700 !important;
}
.btn.primary{
  background: var(--kids-accent) !important;
  border-color: var(--kids-accent-2) !important;
  color:#1b1100 !important;
}

/* ==== 文字區 ==== */
textarea{
  border-radius:14px !important;
  border:2px solid var(--kids-border) !important;
  background:#fffef5 !important;
  color:var(--kids-text) !important;
  box-shadow: inset 0 2px 0 rgba(255,210,89,.5) !important;
  font-size:15px !important;
}

/* ==== 狀態條 ==== */
#status{
  border:2px dashed var(--kids-border) !important;
  border-radius: var(--kids-radius) !important;
  background:#fff7d1 !important;
  color:var(--kids-text) !important;
  box-shadow: var(--kids-shadow) !important;
}

/* ==== 讓網格間距更童趣 ==== */
.grid{ gap:14px !important; }

/* 小角落貼紙（非必要，不依賴原結構） */
body::after{
  content:" 🐻🐰🦊 一起學English！ ";
  position: fixed;
  right: 10px; bottom: 10px;
  background:#fff;
  border:2px solid var(--kids-border);
  border-radius:14px;
  padding:8px 10px;
  box-shadow: var(--kids-shadow);
  font-weight:800;
  color:var(--kids-text);
}

</style>
</head>
<body>
<header>
  <h1>Miss K english class</h1>
 
</header>

<div class="grid">
  <div>
    <label>中文</label>
    <textarea id="inputZh"></textarea>
    <div class="row">
      <button id="btnZhEn" class="btn primary">中文 ➜ 英文</button>
      <button id="btnClearZh" class="btn">清空</button>
    </div>
  </div>

  <div>
    <label>English</label>
    <textarea id="outputEn"></textarea>
    <div class="row">
      <button id="btnEnZh" class="btn primary">英文 ➜ 中文(繁體)</button>
      <button id="btnCheck" class="btn">Grammar</button>
      <button id="btnClearEn" class="btn">清空</button>
    </div>
  </div>
</div>

<div id="status">✨ 直接輸入中文或英文即可。</div>

<script>
(function(){
  const ui = {
    inputZh: document.getElementById('inputZh'),
    outputEn: document.getElementById('outputEn'),
    zh2en: document.getElementById('btnZhEn'),
    en2zh: document.getElementById('btnEnZh'),
    check: document.getElementById('btnCheck'),
    clearZh: document.getElementById('btnClearZh'),
    clearEn: document.getElementById('btnClearEn'),
    status: document.getElementById('status'),
    save: document.getElementById('btnSave'),
    diag: document.getElementById('btnDiag')
  };

  function setStatus(msg){ ui.status.textContent = msg; }

  async function libreTranslate(text, target){
    try{
      const res = await fetch("https://libretranslate.de/translate", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ q:text, source:"auto", target:target, format:"text" })
      });
      if(!res.ok) throw new Error("HTTP "+res.status);
      const data = await res.json();
      return data.translatedText;
    }catch(e){ throw new Error("LibreTranslate 錯誤: "+e.message); }
  }

  async function myMemory(text, source, target){
    const url=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${source}|${target}`;
    const r=await fetch(url);
    const j=await r.json();
    return j?.responseData?.translatedText || "";
  }

  async function translateSmart(text, dir){
    try{
      return await libreTranslate(text, dir==="zh-en"?"en":"zh-TW");
    }catch(e){
      setStatus("⚠️ 主服務失敗，改用後備 MyMemory。");
      return await myMemory(text, dir==="zh-en"?"zh-CN":"en", dir==="zh-en"?"en":"zh-TW");
    }
  }

  async function grammarCheck(text){
    try{
      const p=new URLSearchParams(); p.append("text",text); p.append("language","en-US");
      const r=await fetch("https://api.languagetool.org/v2/check", {method:"POST", headers:{"Content-Type":"application/x-www-form-urlencoded"}, body:p});
      if(!r.ok) throw new Error("HTTP "+r.status);
      const j=await r.json();
      if(!j.matches.length) return text;
      let result=text, shift=0;
      j.matches.sort((a,b)=>a.offset-b.offset).forEach(m=>{
        if(m.replacements[0]){
          const start=m.offset+shift;
          const end=start+m.length;
          const rep=m.replacements[0].value;
          result=result.slice(0,start)+rep+result.slice(end);
          shift+=rep.length-m.length;
        }
      });
      return result;
    }catch(e){
      setStatus("⚠️ Grammar檢查服務失敗，改用簡易改寫。");
      return await myMemory(text,"en","en");
    }
  }

  ui.zh2en.addEventListener('click', async()=>{
    const txt=ui.inputZh.value.trim(); if(!txt) return;
    setStatus("翻譯中（中→英）…");
    ui.outputEn.value=await translateSmart(txt,"zh-en");
    setStatus("✅ 完成：中文→英文");
  });

  ui.en2zh.addEventListener('click', async()=>{
    const txt=ui.outputEn.value.trim(); if(!txt) return;
    setStatus("翻譯中（英→繁體中文）…");
    ui.outputEn.value=await translateSmart(txt,"en-zh");
    setStatus("✅ 完成：英文→中文(繁體)");
  });

  ui.check.addEventListener('click', async()=>{
    const txt=ui.outputEn.value.trim(); if(!txt) return;
    setStatus("Grammar檢查中…");
    ui.outputEn.value=await grammarCheck(txt);
    setStatus("✅ 完成：Grammar check");
  });

  ui.clearZh.addEventListener('click',()=>ui.inputZh.value="");
  ui.clearEn.addEventListener('click',()=>ui.outputEn.value="");
  ui.save.addEventListener('click',()=>{
    const blob=new Blob([document.documentElement.outerHTML],{type:"text/html;charset=utf-8"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a"); a.href=url; a.download="translator-v4.html"; a.click();
    URL.revokeObjectURL(url);
  });
  ui.diag.addEventListener('click', async()=>{
    try{
      const r=await fetch("https://libretranslate.de/");
      setStatus("診斷：LibreTranslate "+(r.ok?"可用":"失敗")+" | HTTP "+r.status);
    }catch(e){ setStatus("診斷：請求失敗，可能被網路問題。"); }
  });

})();
</script>
</body>
</html>
